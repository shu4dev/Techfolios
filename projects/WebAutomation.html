<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Website Automation | Brian Shu | Professional Portfolio">
    <meta name="description" content="">
    <meta name="image" content="https://github.com/shu4dev.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Brian Shu | Professional Portfolio">
    <meta property="og:url" content="https://shu4dev.github.io/projects/WebAutomation.html">
    <meta property="og:title" content="Website Automation | Brian Shu | Professional Portfolio">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://github.com/shu4dev.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/techfolio-theme/default.css">
    <link rel="stylesheet" type="text/css" href="/css/rouge/github.css">
    <!-- Load MathJax if 'mathjax: true' is found in your _config.yml. -->
    
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML">
    </script>
    

    <title>Website Automation | Brian Shu | Professional Portfolio</title>
  </head>
  <body>
  <header class="navbar navbar-expand navbar-light bg-light bg-gradient border-bottom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Chien Hua (Brian) Shu</a>
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <a class="nav-link" href="/#projects">Projects</a>
        <a class="nav-link" href="/#essays">Essays</a>
        <a class="nav-link" href="/resume.html">Resume</a>
      </ul>
    </div>
  </div>
</header>

<div class="container py-4">
  <h1 class="display-4">Website Automation</h1>
 <hr />

<h1 id="introduction">Introduction</h1>
<p>This script is written in Python and utilizes a library called Selenium, which can detect elements in HTML and interact with them.
I created this Python script for my dad to help him reserve a badminton court. At the gym he frequents, court reservations must be made online through their website. The reservation for next week becomes available at midnight. My dad had difficulty operating the computer quickly enough to secure a court, so this script is designed to assist him.</p>

<hr />

<h1 id="start-the-chromedriver">Start the ChromeDriver</h1>

<p>The first part of the script is just the setup of ChromeDriver.  Essentially, driver = webdriver.Chrome() is the ChromeDriver. Options, service, options.add_() are just parameters for the ChromeDriver. I also import some common libraries as well for further functionality.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">twocaptcha</span> <span class="kn">import</span> <span class="n">TwoCaptcha</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span> <span class="n">executable_path</span><span class="o">=</span><span class="s">"your_path"</span><span class="p">)</span>
<span class="n">options</span><span class="p">.</span><span class="n">add_experimental_option</span><span class="p">(</span><span class="s">"detach"</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span> 
<span class="n">service</span> <span class="o">=</span> <span class="n">service</span><span class="p">,</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="get-the-time-right">Get the Time Right</h1>

<p>To ensure this script runs at the time we want I write another getTime() function. Since we want to run the script at 12:00 am one week we have the date we want to reserve. I simply use the calendar to calculate the date. This function returns year, month, day, in string.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">getTime</span><span class="p">():</span>
    <span class="n">now</span>        <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">year</span>       <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y"</span><span class="p">))</span>
    <span class="n">month</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%m"</span><span class="p">))</span>
    <span class="n">TodayDay</span>   <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%d"</span><span class="p">)</span>
    <span class="n">day</span>        <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%d"</span><span class="p">))</span>
    <span class="n">monthrange</span> <span class="o">=</span> <span class="n">calendar</span><span class="p">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">day</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">&gt;</span> <span class="n">monthrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">day</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">monthrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">day</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">&gt;</span> <span class="n">monthrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">year</span>  <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
        <span class="n">month</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">day</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">monthrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">year</span>  <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">day</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">8</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Today is "</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span><span class="s">"/"</span><span class="p">,</span> <span class="n">TodayDay</span><span class="p">,</span> 
          <span class="s">"</span><span class="se">\n</span><span class="s">Intend to reserve for "</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span><span class="s">"/"</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="captcha">Captcha</h1>

<p><img class="img-fluid" src="../img/login.png" /></p>

<hr />

<p>In the image above, I encountered a membership page that required members to enter a verification code (Captcha). To bypass this, I use the TwoCaptcha API, which helps me solve the Captcha and send back the verification code. Essentially, the code below captures the Captcha element on the website, sends it to the TwoCaptcha database, and ultimately retrieves the verification code.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="n">captcha_img</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="s">"xpath"</span><span class="p">,</span> <span class="s">"/html/body/table[2]/tbody/tr/td/form/table/tbody/tr[3]/td[2]/img"</span><span class="p">)</span>
    <span class="n">captcha_img</span><span class="p">.</span><span class="n">screenshot</span><span class="p">(</span><span class="s">'your_path'</span><span class="p">)</span>


    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">'APIKEY_2CAPTCHA'</span><span class="p">,</span> <span class="s">'your_key'</span><span class="p">)</span>

    <span class="n">solver</span> <span class="o">=</span> <span class="n">TwoCaptcha</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="n">normal</span><span class="p">(</span><span class="s">'your_path'</span><span class="p">)</span>

    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">'code'</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">code</span>
</code></pre></div></div>

<hr />

<h1 id="run">Run!!!</h1>

<p>In the following code, we simply run the script with year, month, and day. Essentially, the script will start the ChromeDriver, skip all the alerts, and bypass the member page. After bypassing the member login page, the script will wait until 12:00 AM. At the moment of 12:00 AM, the script to access the reservation page directly by using year, month, day we got from the get time function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="n">solved</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">solve</span><span class="p">()</span>
        <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="s">"xpath"</span><span class="p">,</span> <span class="s">"/html/body/table[2]/tbody/tr/td/form/table/tbody/tr[3]/td[2]/input"</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="s">"xpath"</span><span class="p">,</span> <span class="s">"/html/body/table[2]/tbody/tr/td/form/table/tbody/tr[4]/td/input"</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">alert</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An exception occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%H"</span><span class="p">)</span>
    <span class="nb">min</span>  <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%M"</span><span class="p">)</span>
    <span class="n">sec</span>  <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%S"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Timestamp"</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="s">" : "</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="s">" : "</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(((</span><span class="mi">59</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">))</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">59</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">DoneTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Done Time"</span><span class="p">,</span> <span class="n">DoneTime</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%H:%M:%S"</span><span class="p">))</span>
    
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://fe.xuanen.com.tw/fe01.aspx?module=net_booking&amp;files=booking_place&amp;StepFlag=2&amp;PT=1&amp;D="</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s">"/"</span><span class="o">+</span><span class="n">month</span><span class="o">+</span><span class="s">"/"</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="s">"&amp;D2=1"</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="s">"xpath"</span><span class="p">,</span> <span class="s">"/html/body/table[1]/tbody/tr[3]/td/div/form/table/tbody/tr/td/span/div/table/tbody/tr[2]/td/span/table/tbody/tr[37]/td[3]/img"</span><span class="p">).</span><span class="n">click</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">alert</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="wrap-up">Wrap Up</h1>

<p>In conclusion, the script runs as how a human will operate the website, but in a faster way. It’s a relatively simple and easy script. However, to bypass the member login page and optimize the speed, I do use outside sources and a little bit of observation to help me achieve that.</p>

<p>Source: <a href="https://github.com/shu4dev/WebAutomation/edit/main/BotDemo.py"><i class="large github icon "></i>WebAutomation</a></p>

</div>

<footer class="navbar navbar-expand navbar-light bg-light bg-gradient border-top">
  <div class="container-fluid">
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <small><a class="nav-link" href="https://techfolios.github.io">Made with Techfolios</a></small>
      </ul>
    </div>
  </div>
</footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  </body>
</html>
